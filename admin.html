<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة التحكم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>body{font-family:Tajawal,sans-serif;background:#f5f7fa}.health-green{background:#006747}</style>
</head>
<body class="flex h-screen">
    <aside class="health-green w-64 text-white p-6">
        <h1 class="text-2xl font-bold mb-8">لوحة التحكم</h1>
        <nav><a href="/chat" target="_blank" class="block py-2 hover:bg-white/20 rounded">معاينة الشات</a></nav>
    </aside>
    <main class="flex-1 p-8">
        <h2 class="text-2xl font-bold mb-6">إدارة ملفات PDF</h2>
        <div id="drop" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center mb-6 hover:border-green-500 cursor-pointer bg-white" onclick="document.getElementById('f').click()">
            <input type="file" id="f" class="hidden" accept=".pdf" onchange="up(this)">
            <p class="text-lg mb-2">اضغط هنا لرفع ملف PDF</p>
            <p class="text-sm text-gray-500">أو اسحب الملف هنا</p>
        </div>
        <div id="list" class="bg-white rounded-xl shadow divide-y"></div>
    </main>
    <script>
        const API=window.location.origin;
        async function load(){
            try{
                const r=await fetch(API+"/admin/files");
                const f=await r.json();
                document.getElementById("list").innerHTML=f.length?f.map(x=>`<div class="p-4 flex justify-between items-center"><div><p class="font-bold">${x.filename}</p><p class="text-xs text-gray-500">${new Date(x.date).toLocaleString("ar")}</p></div><button onclick="del('${x.id}')" class="text-red-600 hover:bg-red-50 px-3 py-1 rounded">حذف</button></div>`).join(""):"<div class='p-8 text-center text-gray-500'>لا توجد ملفات</div>";
            }catch(e){document.getElementById("list").innerHTML="<div class='p-8 text-center text-red-500'>تأكد من تشغيل الخادم</div>";}
        }
        async function up(i){
            if(!i.files[0])return;
            const d=new FormData();
            d.append("file",i.files[0]);
            await fetch(API+"/admin/upload",{method:"POST",body:d});
            i.value="";
            load();
        }
        async function del(id){
            if(!confirm("حذف الملف؟"))return;
            await fetch(API+"/admin/files/"+id,{method:"DELETE"});
            load();
        }
        load();
        setInterval(load,3000);
    </script>
</body>
</html>
